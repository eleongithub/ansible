---
# This playbook contains Mod JK installation

- name: Create Mod JK directory
  file: 
    path: "{{ mod_jk_unzip_dir }}"
    state: directory
  
- name: Unzip Mod JK archive
  unarchive: 
    src: "{{ mod_jk_tarball_name }}"
    dest: "{{ mod_jk_unzip_dir }}/"

- name: Configure Mod JK
  shell: cd {{ mod_jk_dir }} && ./configure --with-apr={{ apr_config_file }} --with-apxs={{ apache_home }}/bin/apxs 
  
- name: Make & Make install Mod JK
  shell: cd {{ mod_jk_dir }} && make && make install 

- name: Copy Mod JK library
  shell: cp {{ mod_jk_dir }}/apache-2.0/mod_jk.so {{ apache_home }}/modules/
  
- name: Delete Mod JK install directory
  file: 
    path: "{{ mod_jk_unzip_dir }}"
    state: absent
    
- name: Restart Apache
  command: echo "Restart Apache service..."
  notify: 
    - Restart Apache