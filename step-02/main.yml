---
# This playbook deploys the whole application.  

# 1 - Apply common & firewall roles to all nodes
- hosts: all
  become: yes
  roles:
    - common
    - firewall
    
# 2  - Install java/jdk to all nodes 
- hosts: all
  become: yes
  pre_tasks:
   - name: Get java version installed on the nodes
     shell: java -version 2>&1 | head -n 1 | cut -d'"' -f2
     register: java_installed_version
  roles:
    - { role: jdk, when: " '{{ java_installed_version.stdout }}' != '{{ java_version }}'" }
    
# 3 - Apply Tomcat role to tomcat web server
- hosts: tomcat-middle
  become: yes
  roles:
    - tomcat